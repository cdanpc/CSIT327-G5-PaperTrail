{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - PaperTrail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}?v=4.5">
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}?v=6.0">
    <link rel="stylesheet" href="{% static 'css/profile_style.css' %}?v=4.0">
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle Menu">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Overlay (Mobile) -->
    <div class="sidebar-overlay"></div>

    <!-- Unified Sidebar -->
    <div class="sidebar" id="sidebar">
        <!-- PaperTrail Brand/Toggle -->
        <div class="sidebar-brand-toggle" id="sidebarToggle">
            <i class="fas fa-book-reader"></i>
            <span class="sidebar-text">PaperTrail</span>
        </div>

        <!-- Sidebar Content -->
        <div class="sidebar-content">
            <!-- Main Navigation -->
            <nav class="sidebar-nav">
                <a href="{% url 'accounts:student_dashboard' %}" class="sidebar-item">
                    <i class="fas fa-home"></i>
                    <span class="sidebar-text">Dashboard‎ ‎ ‎ ‎ ‎ </span>
                </a>
                <a href="{% url 'resources:home' %}" class="sidebar-item">
                    <i class="fas fa-book"></i>
                    <span class="sidebar-text">Resources‎ ‎ ‎ ‎ ‎ </span>
                </a>
                <a href="#" class="sidebar-item coming-soon" data-feature="coming-soon">
                    <i class="fas fa-bookmark"></i>
                    <span class="sidebar-text">Bookmarks‎ ‎ ‎ ‎ </span>
                    <span class="coming-soon-badge">Soon</span>
                </a>
                <a href="#" class="sidebar-item coming-soon" data-feature="coming-soon">
                    <i class="fas fa-layer-group"></i>
                    <span class="sidebar-text">Flashcards‎ ‎ ‎ ‎ </span>
                    <span class="coming-soon-badge">Soon</span>
                </a>
                <a href="#" class="sidebar-item coming-soon" data-feature="coming-soon">
                    <i class="fas fa-clipboard-list"></i>
                    <span class="sidebar-text">Quizzes‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ </span>
                    <span class="coming-soon-badge">Soon</span>
                </a>
                <a href="#" class="sidebar-item coming-soon" data-feature="coming-soon">
                    <i class="fas fa-comments"></i>
                    <span class="sidebar-text">Forum‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ </span>
                    <span class="coming-soon-badge">Soon</span>
                </a>
            </nav>

            <!-- Sidebar Footer (Profile, Settings, Sign Out) -->
            <div class="sidebar-footer">
                <a href="{% url 'accounts:profile' %}" class="sidebar-item active">
                    <i class="fas fa-user"></i>
                    <span class="sidebar-text">Profile‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ </span>
                </a>
                <a href="{% url 'accounts:settings' %}" class="sidebar-item">
                    <i class="fas fa-cog"></i>
                    <span class="sidebar-text">Settings‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ </span>
                </a>
                <a href="{% url 'accounts:logout' %}" class="sidebar-item logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="sidebar-text">Sign Out‎ ‎ ‎ ‎ ‎ ‎ ‎ ‎ </span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Dashboard Main -->
        <div class="dashboard-main">
            <div class="container-fluid">
                <!-- Dashboard Header -->
                <div class="dashboard-header">
                    <div class="dashboard-title-section">
                        <h1 class="dashboard-title">Profile</h1>
                    </div>
                    
                    <div class="dashboard-actions">
                        <!-- Search Box -->
                        <div class="search-box-inline">
                            <i class="fas fa-search"></i>
                            <input type="text" class="form-control" placeholder="Search..." aria-label="Search">
                        </div>
                        
                        <!-- Notification Bell -->
                        <button class="icon-btn" data-feature="coming-soon" aria-label="Notifications">
                            <i class="fas fa-bell"></i>
                        </button>
                    </div>
                </div>

                <!-- Profile Content -->
                <div class="profile-layout-wrapper">
                    <!-- LEFT COLUMN: Main Content -->
                    <div class="profile-main-column">
                        <!-- Enhanced Profile Header -->
                        <div class="profile-card profile-header-card">
                            <div class="profile-header-content">
                                <!-- Profile Photo with Edit Overlay -->
                                <div class="profile-photo-wrapper">
                                    <img id="profileImage" 
                                         src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}https://ui-avatars.com/api/?name={{ user.first_name }}+{{ user.last_name }}&size=150&background=667eea&color=fff{% endif %}" 
                                         alt="Profile Photo" 
                                         class="profile-photo-xl">
                                    <div class="photo-edit-overlay" onclick="document.getElementById('photoUploadForm').querySelector('input[type=file]').click()">
                                        <i class="fas fa-camera"></i>
                                        <span class="edit-text">Edit</span>
                                    </div>
                                    <form id="photoUploadForm" method="post" enctype="multipart/form-data" action="{% url 'accounts:profile' %}" style="display: none;">
                                        {% csrf_token %}
                                        <!-- Hidden fields to preserve data -->
                                        <input type="hidden" name="first_name" value="{{ user.first_name }}">
                                        <input type="hidden" name="last_name" value="{{ user.last_name }}">
                                        <input type="hidden" name="personal_email" value="{{ user.personal_email }}">
                                        <input type="hidden" name="phone" value="{{ user.phone|default:'' }}">
                                        <input type="hidden" name="univ_email" value="{{ user.univ_email }}">
                                        <input type="hidden" name="stud_id" value="{{ user.stud_id }}">
                                        <input type="hidden" name="department" value="{{ user.department|default:'' }}">
                                        <input type="hidden" name="year_level" value="{{ user.year_level|default:'' }}">
                                        <input type="hidden" name="bio" value="{{ user.bio|default:'' }}">
                                        <input type="hidden" name="tagline" value="{{ user.tagline|default:'' }}">
                                        <input type="file" id="photoUpload" name="profile_picture" accept="image/*" onchange="this.form.submit()">
                                    </form>
                                </div>
                                
                                <!-- User Identity Section -->
                                <div class="profile-identity">
                                    <div class="profile-name-row">
                                        <h2 class="profile-name">{{ user.get_full_name|default:user.username }}</h2>
                                        {% if user.achievements.filter|length > 0 %}
                                        <span class="verified-badge" title="Verified Student">
                                            <i class="fas fa-check-circle"></i>
                                        </span>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Tagline & Role -->
                                    <div class="profile-tagline-section">
                                        {% if user.tagline %}
                                        <p class="profile-tagline">{{ user.tagline }}</p>
                                        {% else %}
                                        <p class="profile-tagline empty" onclick="toggleEditMode('taglineEdit')">
                                            <i class="fas fa-plus-circle"></i> Add tagline
                                        </p>
                                        {% endif %}
                                        
                                        <span class="profile-role-badge">
                                            {% if user.is_professor %}
                                            <i class="fas fa-chalkboard-teacher"></i> Professor
                                            {% else %}
                                            <i class="fas fa-user-graduate"></i> Student
                                            {% endif %}
                                        </span>
                                    </div>
                                    
                                    <!-- Achievement Badges -->
                                    <div class="profile-badges">
                                        {% for achievement in user.achievements.all %}
                                        {% if achievement.is_displayed and achievement.badge %}
                                        <span class="badge-item badge-{{ achievement.badge.color }}" title="{{ achievement.badge.description }}">
                                            <i class="fas {{ achievement.badge.icon }}"></i>
                                            {{ achievement.badge.name }}
                                        </span>
                                        {% endif %}
                                        {% empty %}
                                        <span class="badge-placeholder">Complete your profile to unlock badges</span>
                                        {% endfor %}
                                    </div>
                                    
                                    <!-- Quick Edit Tagline -->
                                    <div id="taglineEdit-edit" class="edit-form-container" style="margin-top: 1rem;">
                                        <form method="post" action="{% url 'accounts:profile' %}">
                                            {% csrf_token %}
                                            <!-- Hidden fields to preserve data -->
                                            <input type="hidden" name="first_name" value="{{ user.first_name }}">
                                            <input type="hidden" name="last_name" value="{{ user.last_name }}">
                                            <input type="hidden" name="personal_email" value="{{ user.personal_email }}">
                                            <input type="hidden" name="phone" value="{{ user.phone|default:'' }}">
                                            <input type="hidden" name="univ_email" value="{{ user.univ_email }}">
                                            <input type="hidden" name="stud_id" value="{{ user.stud_id }}">
                                            <input type="hidden" name="department" value="{{ user.department|default:'' }}">
                                            <input type="hidden" name="year_level" value="{{ user.year_level|default:'' }}">
                                            <input type="hidden" name="bio" value="{{ user.bio|default:'' }}">
                                            
                                            <div class="form-group">
                                                <input type="text" class="form-control" name="tagline" value="{{ user.tagline }}" placeholder="e.g., Computer Science Student | Active Contributor" maxlength="100">
                                            </div>
                                            <div class="form-actions" style="margin-top: 0.5rem;">
                                                <button type="button" class="btn btn-secondary" onclick="toggleEditMode('taglineEdit')">Cancel</button>
                                                <button type="submit" class="btn btn-primary">Save</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Profile Information Tabs -->
                        <div class="profile-card">
                            <div class="profile-tabs-container">
                                <!-- Tab Navigation -->
                                <div class="profile-tabs-nav">
                                    <button class="profile-tab-btn active" data-tab="personal" onclick="switchTab('personal')">
                                        <i class="fas fa-user"></i>
                                        <span>Personal Info</span>
                                        <span class="tab-completion-badge" id="personalTab-badge">
                                            <i class="fas fa-check-circle"></i>
                                        </span>
                                    </button>
                                    <button class="profile-tab-btn" data-tab="academic" onclick="switchTab('academic')">
                                        <i class="fas fa-university"></i>
                                        <span>Academic Info</span>
                                        <span class="tab-completion-badge" id="academicTab-badge">
                                            <i class="far fa-circle"></i>
                                        </span>
                                    </button>
                                    <button class="profile-tab-btn" data-tab="about" onclick="switchTab('about')">
                                        <i class="fas fa-edit"></i>
                                        <span>About Me</span>
                                        <span class="tab-completion-badge" id="aboutTab-badge">
                                            <i class="far fa-circle"></i>
                                        </span>
                                    </button>
                                </div>

                                <!-- Tab Panels -->
                                <div class="profile-tabs-content">
                                    <!-- Personal Info Tab -->
                                    <div class="profile-tab-panel active" id="personal-tab">
                                        <div class="tab-panel-header">
                                            <h3 class="tab-panel-title">Personal Information</h3>
                                            <button class="btn-edit-mode" onclick="toggleEditMode('personalInfo')">
                                                <i class="fas fa-pencil-alt"></i>
                                                Edit
                                            </button>
                                        </div>

                                        <!-- Display Mode -->
                                        <div id="personalInfo-display" class="info-display-grid">
                                            <div class="info-field">
                                                <label class="info-field-label">First Name</label>
                                                <div class="info-field-value {% if not user.first_name %}empty{% endif %}">
                                                    {{ user.first_name|default:"Not provided" }}
                                                </div>
                                            </div>
                                            <div class="info-field">
                                                <label class="info-field-label">Last Name</label>
                                                <div class="info-field-value {% if not user.last_name %}empty{% endif %}">
                                                    {{ user.last_name|default:"Not provided" }}
                                                </div>
                                            </div>
                                            <div class="info-field">
                                                <label class="info-field-label">Personal Email</label>
                                                <div class="info-field-value {% if not user.personal_email %}empty{% endif %}">
                                                    {{ user.personal_email|default:"Not provided" }}
                                                </div>
                                            </div>
                                            <div class="info-field">
                                                <label class="info-field-label">Phone Number</label>
                                                <div class="info-field-value {% if not user.phone %}empty{% endif %}">
                                                    {{ user.phone|default:"Not provided" }}
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Edit Mode -->
                                        <div id="personalInfo-edit" class="edit-form-container">
                                            <form method="post" action="{% url 'accounts:profile' %}">
                                                {% csrf_token %}
                                                <!-- Hidden fields to preserve data from other tabs -->
                                                <input type="hidden" name="univ_email" value="{{ user.univ_email }}">
                                                <input type="hidden" name="stud_id" value="{{ user.stud_id }}">
                                                <input type="hidden" name="department" value="{{ user.department|default:'' }}">
                                                <input type="hidden" name="year_level" value="{{ user.year_level|default:'' }}">
                                                <input type="hidden" name="bio" value="{{ user.bio|default:'' }}">
                                                
                                                <div class="form-grid">
                                                    <div class="form-group">
                                                        <label for="firstName" class="form-label">First Name</label>
                                                        <input type="text" class="form-control" id="firstName" name="first_name" value="{{ user.first_name }}" placeholder="Enter first name">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="lastName" class="form-label">Last Name</label>
                                                        <input type="text" class="form-control" id="lastName" name="last_name" value="{{ user.last_name }}" placeholder="Enter last name">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="personalEmail" class="form-label">Personal Email</label>
                                                        <input type="email" class="form-control" id="personalEmail" name="personal_email" value="{{ user.personal_email }}" placeholder="your.email@example.com">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="phone" class="form-label">Phone Number</label>
                                                        <input type="tel" class="form-control" id="phone" name="phone" value="{{ user.phone|default:'' }}" placeholder="+63 912 345 6789">
                                                    </div>
                                                </div>
                                                <div class="form-actions">
                                                    <button type="button" class="btn btn-secondary" onclick="toggleEditMode('personalInfo')">Cancel</button>
                                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                    <!-- Academic Info Tab -->
                                    <!-- Academic Information Tab -->
                                    <div class="profile-tab-panel" id="academic-tab">
                                        <div class="tab-panel-header">
                                            <h3 class="tab-panel-title">Academic Information</h3>
                                            <button class="btn-edit-mode" onclick="toggleEditMode('academicInfo')">
                                                <i class="fas fa-pencil-alt"></i>
                                                Edit
                                            </button>
                                        </div>

                                        <!-- Display Mode -->
                                        <div id="academicInfo-display" class="info-display-grid">
                                            <div class="info-field">
                                                <label class="info-field-label">
                                                    University Email
                                                    <i class="fas fa-lock text-muted" style="font-size: 0.75rem; margin-left: 4px;" title="Set during registration"></i>
                                                </label>
                                                <div class="info-field-value">
                                                    {{ user.univ_email }}
                                                </div>
                                            </div>
                                            <div class="info-field">
                                                <label class="info-field-label">
                                                    Student ID
                                                    <i class="fas fa-lock text-muted" style="font-size: 0.75rem; margin-left: 4px;" title="Set during registration"></i>
                                                </label>
                                                <div class="info-field-value">
                                                    {{ user.stud_id }}
                                                </div>
                                            </div>
                                            <div class="info-field">
                                                <label class="info-field-label">Department</label>
                                                <div class="info-field-value {% if not user.department %}empty{% endif %}">
                                                    {{ user.department|default:"Not provided" }}
                                                </div>
                                            </div>
                                            <div class="info-field">
                                                <label class="info-field-label">Year Level</label>
                                                <div class="info-field-value {% if not user.year_level %}empty{% endif %}">
                                                    {% if user.year_level %}{{ user.year_level }}{% if user.year_level == '1' %}st{% elif user.year_level == '2' %}nd{% elif user.year_level == '3' %}rd{% else %}th{% endif %} Year{% else %}Not provided{% endif %}
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Edit Mode -->
                                        <div id="academicInfo-edit" class="edit-form-container">
                                            <form method="post" action="{% url 'accounts:profile' %}">
                                                {% csrf_token %}
                                                <!-- Hidden fields to preserve data from other tabs -->
                                                <input type="hidden" name="first_name" value="{{ user.first_name }}">
                                                <input type="hidden" name="last_name" value="{{ user.last_name }}">
                                                <input type="hidden" name="personal_email" value="{{ user.personal_email }}">
                                                <input type="hidden" name="phone" value="{{ user.phone|default:'' }}">
                                                <input type="hidden" name="bio" value="{{ user.bio|default:'' }}">
                                                
                                                <div class="form-grid">
                                                    <!-- Read-only fields (set during registration) -->
                                                    <div class="form-group">
                                                        <label for="univEmail" class="form-label">
                                                            University Email
                                                            <i class="fas fa-lock text-muted" style="font-size: 0.75rem; margin-left: 4px;" title="Cannot be changed"></i>
                                                        </label>
                                                        <input type="email" class="form-control" id="univEmail" name="univ_email" value="{{ user.univ_email }}" readonly style="background-color: #f8f9fa; cursor: not-allowed;">
                                                        <small class="form-text text-muted">This field was set during registration and cannot be changed.</small>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="studentId" class="form-label">
                                                            Student ID
                                                            <i class="fas fa-lock text-muted" style="font-size: 0.75rem; margin-left: 4px;" title="Cannot be changed"></i>
                                                        </label>
                                                        <input type="text" class="form-control" id="studentId" name="stud_id" value="{{ user.stud_id }}" readonly style="background-color: #f8f9fa; cursor: not-allowed;">
                                                        <small class="form-text text-muted">This field was set during registration and cannot be changed.</small>
                                                    </div>
                                                    
                                                    <!-- Editable fields -->
                                                    <div class="form-group">
                                                        <label for="department" class="form-label">Department</label>
                                                        <input type="text" class="form-control" id="department" name="department" value="{{ user.department|default:'' }}" placeholder="e.g., Computer Science">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="yearLevel" class="form-label">Year Level</label>
                                                        <select class="form-control" id="yearLevel" name="year_level">
                                                            <option value="">Select year</option>
                                                            <option value="1" {% if user.year_level == '1' %}selected{% endif %}>1st Year</option>
                                                            <option value="2" {% if user.year_level == '2' %}selected{% endif %}>2nd Year</option>
                                                            <option value="3" {% if user.year_level == '3' %}selected{% endif %}>3rd Year</option>
                                                            <option value="4" {% if user.year_level == '4' %}selected{% endif %}>4th Year</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="form-actions">
                                                    <button type="button" class="btn btn-secondary" onclick="toggleEditMode('academicInfo')">Cancel</button>
                                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>                                    <!-- About Me Tab -->
                                    <div class="profile-tab-panel" id="about-tab">
                                        <div class="tab-panel-header">
                                            <h3 class="tab-panel-title">About Me</h3>
                                            <button class="btn-edit-mode" onclick="toggleEditMode('bioInfo')">
                                                <i class="fas fa-pencil-alt"></i>
                                                Edit
                                            </button>
                                        </div>

                                        <!-- Display Mode -->
                                        <div id="bioInfo-display">
                                            <div class="info-field">
                                                <label class="info-field-label">Biography</label>
                                                <div class="info-field-value {% if not user.bio %}empty{% endif %}" style="white-space: pre-wrap;">
                                                    {{ user.bio|default:"No bio added yet. Click edit to add information about yourself." }}
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Edit Mode -->
                                        <div id="bioInfo-edit" class="edit-form-container">
                                            <form method="post" action="{% url 'accounts:profile' %}">
                                                {% csrf_token %}
                                                <!-- Hidden fields to preserve data from other tabs -->
                                                <input type="hidden" name="first_name" value="{{ user.first_name }}">
                                                <input type="hidden" name="last_name" value="{{ user.last_name }}">
                                                <input type="hidden" name="personal_email" value="{{ user.personal_email }}">
                                                <input type="hidden" name="phone" value="{{ user.phone|default:'' }}">
                                                <input type="hidden" name="univ_email" value="{{ user.univ_email }}">
                                                <input type="hidden" name="stud_id" value="{{ user.stud_id }}">
                                                <input type="hidden" name="department" value="{{ user.department|default:'' }}">
                                                <input type="hidden" name="year_level" value="{{ user.year_level|default:'' }}">
                                                
                                                <div class="form-group full-width">
                                                    <label for="bio" class="form-label">Biography</label>
                                                    <textarea class="form-control" id="bio" name="bio" rows="6" maxlength="500" placeholder="Tell us about yourself, your interests, academic goals...">{{ user.bio|default:'' }}</textarea>
                                                    <small class="text-muted">Maximum 500 characters</small>
                                                </div>
                                                <div class="form-actions">
                                                    <button type="button" class="btn btn-secondary" onclick="toggleEditMode('bioInfo')">Cancel</button>
                                                    <button type="submit" class="btn btn-primary">Save Changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Your Impact Card -->
                        <div class="profile-card">
                            <div class="card-header-row">
                                <h3 class="card-title">
                                    <i class="fas fa-chart-line"></i>
                                    Your Impact
                                </h3>
                            </div>
                            
                            <div class="impact-stats-grid">
                                <div class="impact-stat-card">
                                    <div class="impact-icon-wrapper purple">
                                        <i class="fas fa-file-upload"></i>
                                    </div>
                                    <div class="impact-stat-content">
                                        <div class="impact-stat-value">{{ user_resources.count }}</div>
                                        <div class="impact-stat-label">Resources Shared</div>
                                    </div>
                                </div>
                                
                                <div class="impact-stat-card">
                                    <div class="impact-icon-wrapper blue">
                                        <i class="fas fa-clipboard-check"></i>
                                    </div>
                                    <div class="impact-stat-content">
                                        <div class="impact-stat-value">0</div>
                                        <div class="impact-stat-label">Quizzes Created</div>
                                        <small class="text-muted">Coming Soon</small>
                                    </div>
                                </div>
                                
                                <div class="impact-stat-card">
                                    <div class="impact-icon-wrapper green">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="impact-stat-content">
                                        <div class="impact-stat-value">0</div>
                                        <div class="impact-stat-label">Students Helped</div>
                                        <small class="text-muted">Based on views</small>
                                    </div>
                                </div>
                                
                                <div class="impact-stat-card">
                                    <div class="impact-icon-wrapper gold">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="impact-stat-content">
                                        <div class="impact-stat-value">0</div>
                                        <div class="impact-stat-label">Helpful Votes</div>
                                        <small class="text-muted">Coming Soon</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Learning Summary Card -->
                        <div class="profile-card">
                            <div class="card-header-row">
                                <h3 class="card-title">
                                    <i class="fas fa-graduation-cap"></i>
                                    Learning Summary
                                </h3>
                            </div>
                            
                            <div class="learning-summary-content">
                                <div class="learning-stat-row">
                                    <div class="learning-stat-item">
                                        <i class="fas fa-fire text-orange"></i>
                                        <div class="learning-stat-info">
                                            <div class="learning-stat-value">0 days</div>
                                            <div class="learning-stat-label">Current Streak</div>
                                        </div>
                                    </div>
                                    <div class="learning-stat-item">
                                        <i class="fas fa-book-open text-purple"></i>
                                        <div class="learning-stat-info">
                                            <div class="learning-stat-value">{{ user_bookmarks.count }}</div>
                                            <div class="learning-stat-label">Bookmarks</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="learning-progress-section">
                                    <div class="learning-progress-header">
                                        <span class="learning-progress-label">Study Progress</span>
                                        <span class="learning-progress-percentage">0%</span>
                                    </div>
                                    <div class="learning-progress-bar">
                                        <div class="learning-progress-fill" style="width: 0%"></div>
                                    </div>
                                    <small class="text-muted">Track your learning journey</small>
                                </div>
                                
                                <div class="recent-activity-section">
                                    <h4 class="recent-activity-title">Recent Activity</h4>
                                    {% if user_resources %}
                                        <div class="recent-activity-list">
                                            {% for resource in user_resources|slice:":3" %}
                                                <div class="recent-activity-item">
                                                    <i class="fas fa-file-alt text-secondary"></i>
                                                    <div class="recent-activity-content">
                                                        <div class="recent-activity-text">Uploaded <strong>{{ resource.title|truncatewords:5 }}</strong></div>
                                                        <div class="recent-activity-time">{{ resource.created_at|timesince }} ago</div>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p class="text-muted text-center py-3">No recent activity yet. Start by uploading a resource!</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Achievements & Badges Card -->
                        <div class="profile-card">
                            <div class="card-header-row">
                                <h3 class="card-title">
                                    <i class="fas fa-trophy"></i>
                                    Achievements & Badges
                                </h3>
                            </div>
                            
                            <div class="achievements-content">
                                <div class="achievements-summary">
                                    <div class="achievements-count">
                                        <span class="count-number">0</span>
                                        <span class="count-total">/ 7</span>
                                    </div>
                                    <p class="text-muted">Complete your profile to unlock achievements!</p>
                                </div>
                                
                                <div class="badges-grid">
                                    <!-- Profile Complete Badge -->
                                    <div class="badge-card locked">
                                        <div class="badge-icon">
                                            <i class="fas fa-user-check"></i>
                                        </div>
                                        <div class="badge-name">Profile Master</div>
                                        <div class="badge-requirement">Complete 100% of profile</div>
                                        <div class="badge-progress">
                                            <div class="badge-progress-bar">
                                                <div class="badge-progress-fill purple" style="width: 0%"></div>
                                            </div>
                                            <small class="badge-progress-text">0%</small>
                                        </div>
                                    </div>
                                    
                                    <!-- First Upload Badge -->
                                    <div class="badge-card {% if user_resources.count > 0 %}unlocked{% else %}locked{% endif %}">
                                        <div class="badge-icon">
                                            <i class="fas fa-rocket"></i>
                                        </div>
                                        <div class="badge-name">First Steps</div>
                                        <div class="badge-requirement">Upload first resource</div>
                                        {% if user_resources.count > 0 %}
                                            <div class="badge-unlocked-badge">
                                                <i class="fas fa-check-circle"></i> Unlocked
                                            </div>
                                        {% else %}
                                            <div class="badge-progress">
                                                <small class="badge-progress-text">Not yet earned</small>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Helpful Contributor Badge -->
                                    <div class="badge-card locked">
                                        <div class="badge-icon">
                                            <i class="fas fa-hands-helping"></i>
                                        </div>
                                        <div class="badge-name">Helpful Contributor</div>
                                        <div class="badge-requirement">Help 50+ students</div>
                                        <div class="badge-progress">
                                            <div class="badge-progress-bar">
                                                <div class="badge-progress-fill green" style="width: 0%"></div>
                                            </div>
                                            <small class="badge-progress-text">0 / 50</small>
                                        </div>
                                    </div>
                                    
                                    <!-- Quiz Creator Badge -->
                                    <div class="badge-card locked">
                                        <div class="badge-icon">
                                            <i class="fas fa-puzzle-piece"></i>
                                        </div>
                                        <div class="badge-name">Quiz Master</div>
                                        <div class="badge-requirement">Create 10 quizzes</div>
                                        <div class="badge-progress">
                                            <small class="badge-progress-text">Coming Soon</small>
                                        </div>
                                    </div>
                                    
                                    <!-- Streak Master Badge -->
                                    <div class="badge-card locked">
                                        <div class="badge-icon">
                                            <i class="fas fa-fire-alt"></i>
                                        </div>
                                        <div class="badge-name">Streak Master</div>
                                        <div class="badge-requirement">30-day streak</div>
                                        <div class="badge-progress">
                                            <div class="badge-progress-bar">
                                                <div class="badge-progress-fill gold" style="width: 0%"></div>
                                            </div>
                                            <small class="badge-progress-text">0 / 30 days</small>
                                        </div>
                                    </div>
                                    
                                    <!-- Top Sharer Badge -->
                                    <div class="badge-card locked">
                                        <div class="badge-icon">
                                            <i class="fas fa-share-alt"></i>
                                        </div>
                                        <div class="badge-name">Top Sharer</div>
                                        <div class="badge-requirement">Share 20+ resources</div>
                                        <div class="badge-progress">
                                            <div class="badge-progress-bar">
                                                <div class="badge-progress-fill blue" data-width="{{ user_resources.count|default:0|floatformat:0|add:0 }}"></div>
                                            </div>
                                            <small class="badge-progress-text">{{ user_resources.count }} / 20</small>
                                        </div>
                                    </div>
                                    
                                    <!-- Verified Student Badge -->
                                    <div class="badge-card locked">
                                        <div class="badge-icon">
                                            <i class="fas fa-certificate"></i>
                                        </div>
                                        <div class="badge-name">Verified Student</div>
                                        <div class="badge-requirement">100% profile + verification</div>
                                        <div class="badge-progress">
                                            <small class="badge-progress-text">Unlock at 100%</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT COLUMN: Status Sidebar -->
                    <div class="profile-status-column">
                        <!-- Completion Card -->
                        <div class="completion-card" id="completionCard">
                            <div class="completion-card-header">
                                <h3 class="completion-title">Complete Your Profile</h3>
                                <button class="completion-info-btn" onclick="showCompletionModal()">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                            </div>
                            
                            <!-- Progress Ring -->
                            <div class="progress-ring-container" id="progressRingContainer">
                                <svg class="progress-ring" width="140" height="140">
                                    <circle class="progress-ring-bg" cx="70" cy="70" r="60" fill="none"></circle>
                                    <circle id="progressRingFill" class="progress-ring-fill" cx="70" cy="70" r="60" fill="none" 
                                            stroke-dasharray="377" stroke-dashoffset="377"></circle>
                                </svg>
                                <div class="progress-percentage-text" id="progressPercentage">0%</div>
                                <!-- Celebration overlay (hidden by default) -->
                                <div class="celebration-overlay" id="celebrationOverlay">
                                    <i class="fas fa-trophy"></i>
                                </div>
                            </div>
                            
                            <!-- Motivational Message -->
                            <div class="completion-message" id="completionMessage">
                                <p class="message-text">Complete your profile to unlock exclusive features!</p>
                            </div>
                            
                            <!-- Checklist -->
                            <div class="completion-checklist">
                                <div class="checklist-item" id="checkPhoto">
                                    <div class="checklist-icon">
                                        <i class="far fa-circle"></i>
                                    </div>
                                    <span class="checklist-label">Add profile photo</span>
                                    <span class="checklist-percentage">25%</span>
                                </div>
                                <div class="checklist-item" id="checkPersonal">
                                    <div class="checklist-icon">
                                        <i class="far fa-circle"></i>
                                    </div>
                                    <span class="checklist-label">Complete personal info</span>
                                    <span class="checklist-percentage">25%</span>
                                </div>
                                <div class="checklist-item" id="checkUniversity">
                                    <div class="checklist-icon">
                                        <i class="far fa-circle"></i>
                                    </div>
                                    <span class="checklist-label">Add university email</span>
                                    <span class="checklist-percentage">25%</span>
                                </div>
                                <div class="checklist-item" id="checkBio">
                                    <div class="checklist-icon">
                                        <i class="far fa-circle"></i>
                                    </div>
                                    <span class="checklist-label">Write bio</span>
                                    <span class="checklist-percentage">25%</span>
                                </div>
                            </div>
                            
                            <!-- Unlock Preview (hidden until near completion) -->
                            <div class="unlock-preview" id="unlockPreview" style="display: none;">
                                <div class="unlock-preview-title">
                                    <i class="fas fa-lock-open"></i>
                                    Almost there! You'll unlock:
                                </div>
                                <ul class="unlock-preview-list">
                                    <li><i class="fas fa-check text-success"></i> Verified Student Badge</li>
                                    <li><i class="fas fa-check text-success"></i> Advanced Analytics</li>
                                    <li><i class="fas fa-check text-success"></i> Profile Themes</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Quick Stats Card -->
                        <div class="profile-card">
                            <h3 class="card-title" style="margin-bottom: 1.5rem;">
                                <i class="fas fa-chart-line"></i>
                                Quick Stats
                            </h3>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-purple);">{{ user_resources.count }}</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Resources</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary-purple);">{{ user_bookmarks.count }}</div>
                                    <div style="font-size: 0.875rem; color: var(--text-secondary);">Bookmarks</div>
                                </div>
                            </div>
                            
                            <div style="padding-top: 1rem; border-top: 1px solid var(--border-light); font-size: 0.875rem; color: var(--text-secondary);">
                                <i class="fas fa-calendar" style="margin-right: 0.5rem;"></i>
                                Member since {{ user.date_joined|date:"F Y" }}
                            </div>
                        </div>
                        
                        <!-- Unlocked Features Card (Phase 7) - Only show at 100% completion -->
                        {% if profile_complete %}
                        <div class="profile-card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 2px solid var(--primary-purple);">
                            <h3 class="card-title" style="margin-bottom: 1.5rem;">
                                <i class="fas fa-unlock-alt" style="color: var(--primary-purple);"></i>
                                Unlocked Features
                            </h3>
                            
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <a href="{% url 'accounts:analytics' %}" class="unlocked-link" style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: white; border-radius: 8px; text-decoration: none; transition: transform 0.2s;">
                                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.25rem;">
                                        <i class="fas fa-chart-pie"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text-primary); font-size: 0.95rem;">Advanced Analytics</div>
                                        <div style="font-size: 0.8rem; color: var(--text-secondary);">View detailed insights</div>
                                    </div>
                                    <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                                </a>
                                
                                <a href="{% url 'accounts:customization' %}" class="unlocked-link" style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: white; border-radius: 8px; text-decoration: none; transition: transform 0.2s;">
                                    <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.25rem;">
                                        <i class="fas fa-palette"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text-primary); font-size: 0.95rem;">Profile Themes</div>
                                        <div style="font-size: 0.8rem; color: var(--text-secondary);">Customize your profile</div>
                                    </div>
                                    <i class="fas fa-chevron-right" style="color: var(--text-muted);"></i>
                                </a>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
        <div id="featureToast" class="toast">
            <div class="toast-header bg-info text-white">
                <i class="fas fa-info-circle me-2"></i>
                <strong class="me-auto">Feature Coming Soon</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">This feature is currently under development and will be available soon!</div>
        </div>
    </div>

    <!-- 100% Completion Celebration Modal -->
    <div class="modal fade" id="celebrationModal" tabindex="-1" aria-labelledby="celebrationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content celebration-modal-content">
                <div class="modal-header border-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center celebration-modal-body">
                    <!-- Confetti Animation Container -->
                    <div class="confetti-container" id="confettiContainer"></div>
                    
                    <!-- Trophy Icon with Animation -->
                    <div class="celebration-trophy">
                        <i class="fas fa-trophy"></i>
                    </div>
                    
                    <!-- Congratulations Message -->
                    <h2 class="celebration-heading">Congratulations!</h2>
                    <p class="celebration-subheading">You've completed your profile! 🎉</p>
                    
                    <!-- Unlocked Features -->
                    <div class="unlocked-features">
                        <h4 class="unlocked-features-title">You've Unlocked:</h4>
                        <div class="unlocked-features-list">
                            <div class="unlocked-feature-item">
                                <div class="unlocked-feature-icon verified">
                                    <i class="fas fa-certificate"></i>
                                </div>
                                <div class="unlocked-feature-content">
                                    <div class="unlocked-feature-name">Verified Student Badge</div>
                                    <div class="unlocked-feature-desc">Display your verified status</div>
                                </div>
                            </div>
                            <a href="{% url 'accounts:analytics' %}" class="unlocked-feature-item" style="text-decoration: none; color: inherit;">
                                <div class="unlocked-feature-icon insights">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="unlocked-feature-content">
                                    <div class="unlocked-feature-name">Advanced Analytics</div>
                                    <div class="unlocked-feature-desc">View detailed insights</div>
                                </div>
                            </a>
                            <a href="{% url 'accounts:customization' %}" class="unlocked-feature-item" style="text-decoration: none; color: inherit;">
                                <div class="unlocked-feature-icon customization">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <div class="unlocked-feature-content">
                                    <div class="unlocked-feature-name">Profile Themes</div>
                                    <div class="unlocked-feature-desc">Customize your profile</div>
                                </div>
                            </a>
                        </div>
                    </div>
                    
                    <!-- CTA Button -->
                    <button type="button" class="btn btn-primary btn-lg celebration-cta" data-bs-dismiss="modal">
                        <i class="fas fa-rocket"></i>
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Completion Info Modal -->
    <div class="modal fade" id="completionInfoModal" tabindex="-1" aria-labelledby="completionInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="completionInfoModalLabel">
                        <i class="fas fa-info-circle text-primary"></i>
                        Profile Completion Benefits
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-secondary mb-3">Complete your profile to unlock amazing features and enhance your PaperTrail experience!</p>
                    
                    <div class="completion-benefits">
                        <div class="completion-benefit-item">
                            <div class="benefit-icon">
                                <i class="fas fa-check-circle text-success"></i>
                            </div>
                            <div class="benefit-content">
                                <strong>Verified Badge</strong>
                                <p>Stand out with a verified student badge on your profile</p>
                            </div>
                        </div>
                        <div class="completion-benefit-item">
                            <div class="benefit-icon">
                                <i class="fas fa-chart-line text-primary"></i>
                            </div>
                            <div class="benefit-content">
                                <strong>Advanced Analytics</strong>
                                <p>Access detailed insights about your contributions and impact</p>
                            </div>
                        </div>
                        <div class="completion-benefit-item">
                            <div class="benefit-icon">
                                <i class="fas fa-paint-brush text-warning"></i>
                            </div>
                            <div class="benefit-content">
                                <strong>Profile Customization</strong>
                                <p>Unlock custom themes and colors for your profile</p>
                            </div>
                        </div>
                        <div class="completion-benefit-item">
                            <div class="benefit-icon">
                                <i class="fas fa-trophy text-gold"></i>
                            </div>
                            <div class="benefit-content">
                                <strong>Achievement System</strong>
                                <p>Earn exclusive badges and unlock new achievements</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{% static 'js/sidebar.js' %}?v=5.0"></script>
    <script src="{% static 'js/profile.js' %}?v=3.0"></script>
    
    <!-- Apply badge progress widths from data attributes -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.badge-progress-fill[data-width]').forEach(function(element) {
                const width = element.dataset.width;
                if (width) {
                    element.style.width = width + '%';
                }
            });
        });
    </script>
    
    <!-- Profile Data for JavaScript -->
    <div id="profileData" style="display: none;"
         data-has-photo="{% if user.profile_picture %}true{% else %}false{% endif %}"
         data-has-personal-info="{% if user.first_name and user.last_name and user.personal_email %}true{% else %}false{% endif %}"
         data-has-univ-email="{% if user.univ_email %}true{% else %}false{% endif %}"
         data-has-bio="{% if user.bio %}true{% else %}false{% endif %}"
         data-has-first-name="{% if user.first_name %}true{% else %}false{% endif %}"
         data-has-last-name="{% if user.last_name %}true{% else %}false{% endif %}"
         data-has-personal-email="{% if user.personal_email %}true{% else %}false{% endif %}"
         data-has-phone="{% if user.phone %}true{% else %}false{% endif %}"
         data-has-stud-id="{% if user.stud_id %}true{% else %}false{% endif %}"
         data-has-department="{% if user.department %}true{% else %}false{% endif %}"
         data-has-year-level="{% if user.year_level %}true{% else %}false{% endif %}">
    </div>
</body>
</html>
