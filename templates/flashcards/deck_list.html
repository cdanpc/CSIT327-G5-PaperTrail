{% extends 'base_dashboard.html' %}
{% load static humanize %}

{% block title %}Flashcards{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/flashcards.css' %}?v=1.1">
<link rel="stylesheet" href="{% static 'css/resources.css' %}?v=1.0">
<link rel="stylesheet" href="{% static 'css/components.css' %}">
{% endblock %}

{% block header %}
{% include 'components/page_header.html' with page_title="Flashcards" search_placeholder="Search decks..." search_name="q" search_value=query show_moderate_btn=False %}
{% endblock %}

{% block content %}
<div class="resources-tabs-row d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3" style="margin-top: 0rem;">
    <div class="resources-tabs flashcards-tabs" role="tablist" aria-label="Flashcards scope">
      <a href="{% url 'flashcards:deck_create' %}" class="btn btn-pill btn-pill--primary" role="button" title="Create a new deck"><i class="fas fa-plus"></i> New Deck</a>
      <a href="{% url 'flashcards:deck_list' %}?scope=all" class="btn-tab {% if scope != 'mine' %}active{% endif %}" role="tab" aria-selected="{% if scope != 'mine' %}true{% else %}false{% endif %}">All Decks</a>
      <a href="{% url 'flashcards:deck_list' %}?scope=mine" class="btn-tab {% if scope == 'mine' %}active{% endif %}" role="tab" aria-selected="{% if scope == 'mine' %}true{% else %}false{% endif %}">My Decks</a>
    </div>
    <div class="d-flex align-items-center gap-2" aria-label="Filter decks">
      <form method="get" action="" class="m-0">
        {% if query %}<input type="hidden" name="q" value="{{ query }}">{% endif %}
        {% if scope %}<input type="hidden" name="scope" value="{{ scope }}">{% endif %}
        {% include 'components/filter_sort.html' with filter_name="category" filter_label="All Categories" filter_options=category_options selected_value=selected_category %}
      </form>
    </div>
  </div>

<div class="fc-container fc-list">
  

  {% if decks %}
  <div class="row g-3">
    {% for deck in decks %}
    <div class="col-md-6 col-lg-4">
      <div class="study-card">
        <div class="study-card__header">
          <span class="study-card__type">Flashcard</span>
          <form method="post" action="{% url 'flashcards:bookmark_toggle' deck.pk %}" class="study-card__bookmark-form">
            {% csrf_token %}
            <button type="submit" class="study-card__bookmark-btn" aria-label="{% if deck.is_bookmarked %}Remove bookmark{% else %}Add bookmark{% endif %}">
              <i class="{% if deck.is_bookmarked %}fas{% else %}far{% endif %} fa-bookmark"></i>
            </button>
          </form>
        </div>

        <div class="study-card__body">
          <h3 class="study-card__title">{{ deck.title }}</h3>
          
          <div class="study-card__tags">
            {% if deck.visibility == 'public' %}
              {% if deck.verification_status == 'verified' %}
                <span class="study-card__tag study-card__tag--verified"><i class="fas fa-check-circle"></i> Verified</span>
              {% elif deck.verification_status == 'pending' %}
                <span class="study-card__tag study-card__tag--pending"><i class="fas fa-clock"></i> Pending</span>
              {% endif %}
              <span class="study-card__tag study-card__tag--public"><i class="fas fa-globe"></i> Public</span>
            {% else %}
              <span class="study-card__tag study-card__tag--private"><i class="fas fa-lock"></i> Private</span>
            {% endif %}
          </div>

          <p class="study-card__author">{{ deck.get_category_display }}</p>

          <div class="study-card__metrics">
            <span><i class="fas fa-layer-group"></i> {{ deck.cards_count }} card{{ deck.cards_count|pluralize }}</span>
            {% if deck.last_studied_at %}
              <span class="metric-dot">â€¢</span>
              <span><i class="fas fa-clock"></i> {{ deck.last_studied_at|timesince }} ago</span>
            {% endif %}
          </div>
        </div>

        <div class="study-card__footer">
          <a href="{% url 'flashcards:deck_detail' deck.pk %}" class="btn btn--primary btn--block">
            <i class="fas fa-play"></i> Study Deck
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="fc-empty">
    {% if scope == 'mine' %}
      <strong>You haven't created any decks yet</strong>
      <div class="mt-2">Create a deck to start studying.</div>
    {% else %}
      <strong>No public decks available yet</strong>
      <div class="mt-2">Please check back later.</div>
    {% endif %}
    <div class="mt-3"><a href="{% url 'flashcards:deck_create' %}" class="fc-btn fc-btn-primary"><i class="fas fa-plus"></i><span> New Deck</span></a></div>
  </div>
  {% endif %}
</div>
{% endblock %}
