{% extends 'base_dashboard.html' %}
{% load static %}

{% block title %}{{ thread.title }} - Forum{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/forum.css' %}">
{% endblock %}

{% block content %}
<div class="forum-container">
  <div class="forum-breadcrumb">
    <a href="{% url 'forum:home' %}"><i class="fas fa-home"></i> Forum</a>
    <i class="fas fa-chevron-right"></i>
    <a href="{% url 'forum:topic_threads' thread.topic.id %}">{{ thread.topic.name }}</a>
    <i class="fas fa-chevron-right"></i>
    <span>{{ thread.title }}</span>
  </div>

  <div class="forum-thread-detail">
    <!-- Main Thread Post -->
    <div class="forum-thread-main">
      <h1 class="forum-thread-main__title">{{ thread.title }}</h1>
      
      <div class="forum-post forum-post--main">
        <div class="forum-post__header">
          <div class="forum-post__avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <div class="forum-post__author-info">
            <span class="forum-post__author">{{ thread.starter.first_name }} {{ thread.starter.last_name }}</span>
            <span class="forum-post__username">@{{ thread.starter.username }}</span>
            <span class="forum-post__timestamp">
              <i class="far fa-clock"></i>
              {{ thread.created_at|date:"M d, Y \a\t h:i A" }}
            </span>
          </div>
        </div>
        
        <div class="forum-post__content">
          {{ thread.content|linebreaks }}
        </div>
        
        <div class="forum-post__stats">
          <span>
            <i class="fas fa-reply"></i>
            <span id="totalRepliesCount">0</span> Replies
          </span>
          <span>
            <i class="fas fa-eye"></i>
            Last activity {{ thread.last_activity_at|timesince }} ago
          </span>
        </div>
      </div>
    </div>

    <!-- Reply Form -->
    <div class="forum-reply-section">
      {% include 'forum/components/post_reply_form.html' with thread=thread %}
    </div>

    <!-- Replies List -->
    <div class="forum-replies">
      <h3 class="forum-replies__title">
        <i class="fas fa-comments"></i> 
        Replies (<span id="repliesCount">0</span>)
      </h3>
      
      <div id="postsContainer" class="forum-posts-list">
        <div class="loading-spinner" id="postsLoading">
          <i class="fas fa-spinner fa-spin"></i> Loading replies...
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/forum.js' %}"></script>
<script>
  const THREAD_ID = {{ thread.id }};
  
  document.addEventListener('DOMContentLoaded', function() {
    ForumApp.loadThreadPosts(THREAD_ID);
    ForumApp.initReplyForm(THREAD_ID);
  });
</script>
{% endblock %}
