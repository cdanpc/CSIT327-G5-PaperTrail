{% extends 'base_dashboard.html' %}
{% load static %}

{% block title %}{{ topic.name }} - Forum{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/forum.css' %}">
{% endblock %}

{% block content %}
<div class="forum-container">
  <div class="forum-breadcrumb">
    <a href="{% url 'forum:home' %}"><i class="fas fa-home"></i> Forum</a>
    <i class="fas fa-chevron-right"></i>
    <span>{{ topic.name }}</span>
  </div>

  <div class="forum-header">
    <h1 class="page-title">
      <i class="fas fa-layer-group"></i> {{ topic.name }}
    </h1>
    <p class="page-subtitle">{{ topic.description }}</p>
  </div>

  <div class="forum-actions">
    <button class="btn btn--primary" id="newThreadBtn">
      <i class="fas fa-plus"></i> Start New Thread
    </button>
  </div>

  <!-- New Thread Modal/Form (hidden by default) -->
  <div class="forum-new-thread" id="newThreadForm" style="display: none;">
    <div class="forum-new-thread__card">
      <h3><i class="fas fa-edit"></i> Start a New Discussion</h3>
      <form id="createThreadForm">
        {% csrf_token %}
        <input type="hidden" name="topic_id" value="{{ topic.id }}">
        
        <div class="form-group">
          <label for="threadTitle">Thread Title <span class="required">*</span></label>
          <input type="text" id="threadTitle" name="title" class="form-control" placeholder="What's your question or topic?" required>
        </div>
        
        <div class="form-group">
          <label for="threadContent">Content <span class="required">*</span></label>
          <textarea id="threadContent" name="content" class="form-control form-textarea" rows="8" placeholder="Describe your question or start the discussion... (Markdown supported)" required></textarea>
        </div>
        
        <div class="forum-new-thread__actions">
          <button type="button" class="btn btn--secondary" id="cancelThreadBtn">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button type="submit" class="btn btn--primary">
            <i class="fas fa-paper-plane"></i> Create Thread
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="forum-threads-list" id="threadsContainer">
    <div class="loading-spinner" id="threadsLoading">
      <i class="fas fa-spinner fa-spin"></i> Loading threads...
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/forum.js' %}"></script>
<script>
  const TOPIC_ID = {{ topic.id }};
  
  document.addEventListener('DOMContentLoaded', function() {
    ForumApp.loadTopicThreads(TOPIC_ID);
    ForumApp.initNewThreadForm(TOPIC_ID);
  });
</script>
{% endblock %}
