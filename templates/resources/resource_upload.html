{% extends 'base_dashboard.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Upload Resource{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/resources.css' %}?v=1.0">
{% endblock %}

{% block header %}
{% url 'resources:resource_list' as resources_url %}
{% include 'components/page_header.html' with page_title='Upload Resource' back_url=resources_url show_moderate_btn=False %}
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        
        <!-- Upload Form Card -->
        <div class="card dashboard-card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-upload"></i> Submit New Resource
                </h5>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}
                    
                    <!-- Basic Details -->
                    <div class="mb-4">
                        <h6 style="font-weight: 700; color: #1a1a1a; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid rgba(102, 126, 234, 0.1);">
                            <i class="fas fa-info-circle" style="color: #667eea;"></i> Basic Details
                        </h6>
                        {{ form.title|as_crispy_field }}
                        {{ form.description|as_crispy_field }}
                    </div>

                    <!-- Resource Type -->
                    <div class="mb-4">
                        <h6 style="font-weight: 700; color: #1a1a1a; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid rgba(102, 126, 234, 0.1);">
                            <i class="fas fa-tag" style="color: #667eea;"></i> Resource Type
                        </h6>
                        {{ form.resource_type|as_crispy_field }}
                    </div>
                    
                    <!-- File Upload Field -->
                    <div class="mb-4">
                        <h6 style="font-weight: 700; color: #1a1a1a; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid rgba(102, 126, 234, 0.1);">
                            <i class="fas fa-file-alt" style="color: #667eea;"></i> File Upload
                        </h6>
                        <div class="soft-panel">
                            {{ form.file|as_crispy_field }}
                            <div class="alert alert-info alert-soft-primary mt-3 mb-0">
                                <i class="fas fa-info-circle"></i>
                                <strong>Supported formats:</strong> PDF, PPT, PPTX, DOCX, TXT, JPG, PNG. <strong>Max size:</strong> 5MB.
                            </div>
                        </div>
                    </div>

                    <!-- External URL Field -->
                    <div class="mb-4">
                        <h6 style="font-weight: 700; color: #1a1a1a; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid rgba(102, 126, 234, 0.1);">
                            <i class="fas fa-globe" style="color: #667eea;"></i> External Link (Alternative)
                        </h6>
                        <div class="soft-panel">
                            {{ form.external_url|as_crispy_field }}
                            <div class="alert alert-info alert-soft-primary mt-3 mb-0">
                                <i class="fas fa-info-circle"></i>
                                <strong>Note:</strong> Provide either a file OR an external URL (not both). If uploading a file, leave this blank.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tags -->
                    <div class="mb-4">
                        <h6 style="font-weight: 700; color: #1a1a1a; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid rgba(102, 126, 234, 0.1);">
                            <i class="fas fa-tags" style="color: #667eea;"></i> Tags (Optional)
                        </h6>
                        {{ form.tags|as_crispy_field }}
                    </div>
                    
                    <!-- Privacy Settings -->
                    <div class="mb-4">
                        <h6 style="font-weight: 700; color: #1a1a1a; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid rgba(102, 126, 234, 0.1);">
                            <i class="fas fa-lock" style="color: #667eea;"></i> Privacy Settings
                        </h6>
                        <div class="soft-panel">
                            <div class="form-check form-switch">
                                {{ form.is_public }}
                                <label class="form-check-label" for="{{ form.is_public.id_for_label }}" style="margin-left: 0.5rem;">
                                    {{ form.is_public.label }}
                                </label>
                            </div>
                            <div class="alert alert-info alert-soft-primary mt-3 mb-0">
                                <i class="fas fa-info-circle"></i>
                                <strong>Public:</strong> Visible in "All Resources" after verification. 
                                <strong>Private:</strong> Only visible to you in "My Resources".
                            </div>
                        </div>
                    </div>
                    
                    <!-- Errors -->
                    {% if form.non_field_errors %}
                    <div class="alert alert-danger mb-4">
                        <i class="fas fa-exclamation-circle"></i> {{ form.non_field_errors.0 }}
                    </div>
                    {% endif %}
                    
                    <!-- Submit Button -->
                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-lg btn-gradient-primary" style="padding: 1rem; border-radius: 12px; font-weight: 700;">
                            <i class="fas fa-upload"></i> {% if user.is_professor %}Submit & Publish{% else %}Submit for Review{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Guidelines Card -->
        <div class="card dashboard-card mt-3">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle"></i> Upload Guidelines
                </h5>
            </div>
            <div class="card-body">
                <div class="alert" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 1px solid rgba(102, 126, 234, 0.2); color: #667eea; border-radius: 8px; margin: 0;">
                    <i class="fas fa-lightbulb"></i>
                    <strong>Note:</strong> 
                    {% if user.is_professor %}
                    Your uploads will be published immediately as verified content.
                    {% else %}
                    All uploads are reviewed by professors before being published. You'll be notified once your resource is verified.
                    {% endif %}
                </div>
                
                <div class="mt-3">
                    <h6 style="font-weight: 600; color: #1a1a1a; margin-bottom: 0.75rem;">Tips for better resources:</h6>
                    <ul style="color: #4b5563; line-height: 1.8; margin: 0; padding-left: 1.5rem;">
                        <li>Provide clear, descriptive titles</li>
                        <li>Add detailed descriptions to help others find your resource</li>
                        <li>Use relevant tags for better discoverability</li>
                        <li>Ensure your files are high quality and properly formatted</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}