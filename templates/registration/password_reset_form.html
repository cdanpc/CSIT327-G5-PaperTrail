{% extends 'base_auth.html' %}
{% load static %}

{% block title %}Forgot Password{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/login_new.css' %}">
{% endblock %}

{% block icon %}key{% endblock %}
{% block page_title %}Forgot Password?{% endblock %}
{% block page_subtitle %}Enter your Gmail address to reset your password{% endblock %}

{% block content %}
<form method="post" novalidate id="passwordResetForm">
    {% csrf_token %}
    
    <!-- Email Field -->
    <div class="form-field">
        <label for="id_email">Gmail Address</label>
        <div class="input-wrapper">
            <input 
                type="email" 
                name="email" 
                id="id_email" 
                class="{% if form.email.errors %}error{% endif %}"
                value="{{ form.email.value|default:'' }}"
                placeholder="your.email@gmail.com"
                required
                autofocus
            >
            {% if form.email.errors %}
            <i class="fas fa-exclamation-circle validation-icon error"></i>
            <div class="validation-tooltip">{{ form.email.errors.0 }}</div>
            {% endif %}
        </div>
        <div class="field-hint">
            <i class="fas fa-info-circle"></i>
            <span>Enter your Gmail address associated with your account</span>
        </div>
    </div>
    
    <!-- Non-field errors -->
    {% if form.non_field_errors %}
    <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        {{ form.non_field_errors.0 }}
    </div>
    {% endif %}
    
    <!-- Submit Button -->
    <button type="submit" class="submit-btn">
        <i class="fas fa-paper-plane"></i> Send Reset Link
    </button>
    
    <!-- Back to Login -->
    <div class="register-link">
        Remember your password? <a href="{% url 'accounts:login' %}">Back to Login</a>
    </div>
</form>

<!-- Back to Home -->
<div class="back-link">
    <a href="{% url 'home' %}">
        <i class="fas fa-arrow-left"></i> Back to Home
    </a>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Client-side email validation
    document.getElementById('passwordResetForm').addEventListener('submit', function(e) {
        const emailInput = document.getElementById('id_email');
        const email = emailInput.value.trim().toLowerCase();
        
        // Accept Gmail only
        if (!email.endsWith('@gmail.com')) {
            e.preventDefault();
            emailInput.classList.add('error');
            
            // Show error message
            const wrapper = emailInput.closest('.input-wrapper');
            let errorIcon = wrapper.querySelector('.validation-icon');
            let errorTooltip = wrapper.querySelector('.validation-tooltip');
            
            if (!errorIcon) {
                errorIcon = document.createElement('i');
                errorIcon.className = 'fas fa-exclamation-circle validation-icon error';
                wrapper.appendChild(errorIcon);
            }
            
            if (!errorTooltip) {
                errorTooltip = document.createElement('div');
                errorTooltip.className = 'validation-tooltip';
                wrapper.appendChild(errorTooltip);
            }
            
            errorTooltip.textContent = 'Please use your Gmail address (@gmail.com).';
        }
    });
    
    // Clear error on input
    document.getElementById('id_email').addEventListener('input', function() {
        this.classList.remove('error');
        const wrapper = this.closest('.input-wrapper');
        const errorIcon = wrapper.querySelector('.validation-icon');
        const errorTooltip = wrapper.querySelector('.validation-tooltip');
        if (errorIcon) errorIcon.remove();
        if (errorTooltip) errorTooltip.remove();
    });
</script>
{% endblock %}
