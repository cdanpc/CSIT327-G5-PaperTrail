{% extends 'base_dashboard.html' %}
{% load static %}

{% block title %}Bookmarks{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/resources.css' %}?v=1.0">
<style>
    .bookmarks-header-row { justify-content: space-between; gap: 12px; }
    .bookmarks-header-row .filter-select { min-width: 220px; }
    .bookmarks-header-row .filter-form { margin-left: auto; }
    .resources-grid { margin-top: 12px; }
</style>
{% endblock %}

{% block page_title %}Bookmarks{% endblock %}

{% block content %}
    <div class="d-flex align-items-center bookmarks-header-row flex-wrap">
        <div class="d-flex align-items-center gap-2 flex-wrap justify-content-center">
            <a href="{% url 'resources:resource_list' %}" class="btn-upload-pill btn-pill" title="Browse all resources">Browse Resources</a>
            <a href="{% url 'flashcards:deck_list' %}" class="btn-upload-pill btn-pill" title="Browse all flashcards">Browse Flashcards</a>
            <a href="{% url 'quizzes:quiz_list' %}" class="btn-upload-pill btn-pill" title="Browse all quizzes">Browse Quizzes</a>
        </div>
        <form method="get" class="d-flex align-items-center gap-2 filter-form" aria-label="Filter bookmarks">
            <select name="btype" class="filter-select" aria-label="Bookmark type" onchange="this.form.submit()">
                <option value="" {% if not btype %}selected{% endif %}>All</option>
                <option value="resources" {% if btype == 'resources' %}selected{% endif %}>Resources</option>
                <option value="quizzes" {% if btype == 'quizzes' %}selected{% endif %}>Quizzes</option>
                <option value="flashcards" {% if btype == 'flashcards' %}selected{% endif %}>Flashcards</option>
            </select>
        </form>
    </div>
    <div class="resources-grid" id="bookmarksGrid">
        {% for item in items %}
            <div class="resource-card-v2" data-type="{{ item.type }}" data-id="{{ item.id }}">
                <div class="rcv2-head">
                    <span class="rcv2-type">{% if item.type == 'resource' %}{{ item.resource_type|upper }}{% elif item.type == 'quiz' %}QUIZ{% else %}DECK{% endif %}</span>
                    <form method="post" action="{{ item.remove_url }}">
                        {% csrf_token %}
                        <input type="hidden" name="next" value="{{ request.path }}">
                        <button type="submit" class="rcv2-remove-indicator" title="Remove bookmark" aria-label="Remove bookmark"><i class="fas fa-xmark"></i></button>
                    </form>
                </div>
                <a href="{{ item.detail_url }}" class="rcv2-body" aria-label="View {{ item.type }} {{ item.title }}">
                    <div class="rcv2-icon-wrapper">
                        {% if item.type == 'resource' %}
                            <div class="rcv2-icon"><i class="fas fa-{% if item.resource_type == 'pdf' %}file-pdf{% elif item.resource_type == 'image' %}image{% elif item.resource_type == 'ppt' or item.resource_type == 'pptx' %}file-powerpoint{% elif item.resource_type == 'docx' %}file-word{% elif item.resource_type == 'txt' %}file-lines{% elif item.resource_type == 'link' %}link{% else %}file-alt{% endif %}"></i></div>
                        {% elif item.type == 'quiz' %}
                            <div class="rcv2-icon"><i class="fas fa-question"></i></div>
                        {% else %}
                            <div class="rcv2-icon"><i class="fas fa-clone"></i></div>
                        {% endif %}
                        {% if item.verification_status == 'verified' %}
                            <span class="rcv2-verify-badge" title="Verified"><i class="fas fa-check"></i></span>
                        {% elif item.verification_status == 'pending' %}
                            <span class="rcv2-pending-badge" title="Pending"><i class="fas fa-clock"></i></span>
                        {% endif %}
                    </div>
                    <h3 class="rcv2-title" title="{{ item.title }}">{{ item.title }}</h3>
                    <div class="rcv2-metrics">
                        {% if item.type == 'resource' %}
                            <span><i class="fas fa-eye"></i> {{ item.views }}</span>
                            <span><i class="fas fa-download"></i> {{ item.downloads }}</span>
                            {% if item.rating %}<span><i class="fas fa-star"></i> {{ item.rating|floatformat:1 }}</span>{% endif %}
                        {% elif item.type == 'quiz' %}
                            <span><i class="fas fa-question-circle"></i> {{ item.questions }} Q</span>
                            <span><i class="fas fa-chart-line"></i> {{ item.attempts }} attempts</span>
                        {% else %}
                            <span><i class="fas fa-layer-group"></i> {{ item.cards }} cards</span>
                        {% endif %}
                    </div>
                </a>
                <div class="rcv2-footer">
                    <span class="rcv2-author">By: {{ item.author }}</span>
                    <span class="rcv2-age">{{ item.created_at|timesince }} ago</span>
                </div>
            </div>
        {% empty %}
            <div class="resources-empty">No bookmarks yet.</div>
        {% endfor %}
    </div>
{% endblock %}

{% block extra_js %}{% endblock %}
